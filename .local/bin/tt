#!/bin/sh

[ "$1" != '-a' ] && grepadd='\(-L,\|[A-Z]-1,\)' || grepadd=''

curl -s webspace.apiit.edu.my/intake-timetable/download_timetable/timetableCSV.zip \
  | bsdtar -xOf- | grep UCFF1604CT | grep "$grepadd" | cut -f3- -d, \
  | sed -e "
    s/[^,]*,/$(printf '\033[35m')&/1  # 1: magenta
    s/[^,]*,/$(printf '\033[32m')&/2  # 2: green
    s/[^,]*,/$(printf '\033[31m')&/3  # 3: red
    s/[^,]*,/$(printf '\033[33m')&/5  # 5: yellow
    s/[^,]*$/$(printf '\033[36m')&/   # $: cyan
    s/$/$(printf '\033[m')/           # cleanup
    s/[A-Z]*[0-9]\{3\}-[0-9]-[0-9]-\([A-Z]*\)-/\1,/  # Simplify course
    s/\([0-9][0-9]\):\([0-9][0-9]\)/\1\2/g           # 4 digits time
    s/-[0-9]\{4\}//  # Remove year
    s/\s\-\s/\-/g    # Remove useless spaces" \
  | column -t -s,
